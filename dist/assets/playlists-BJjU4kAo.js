import{j as e,g as t}from"./index-BZKzq6T1.js";import{d as s,b as r}from"./vendor-Cml8jNaD.js";import{u as a}from"./navigation-CVpX3VBE.js";import{W as l}from"./config-BQFUInJh.js";import{S as i}from"./SharedBottomBar-CuTRwZs0.js";import{C as n}from"./chevron-left-Dz_sUr7q.js";import{P as o,M as c}from"./pencil-FVDXLLel.js";import{B as d}from"./bookmark-BQu8GbS9.js";import{L as m}from"./lightbulb-DysG5pEb.js";import{L as u}from"./list-plus-eZpmYSQl.js";import"./home-BdZ4crgw.js";const x="playlists_v1";function h(){try{const e=localStorage.getItem(x),t=e?JSON.parse(e):{lists:[]};return Array.isArray(t)?{lists:t}:{lists:Array.isArray(t.lists)?t.lists:[]}}catch{return{lists:[]}}}function g(e){try{localStorage.setItem(x,JSON.stringify({lists:e.lists||[]}))}catch{}try{window.dispatchEvent(new CustomEvent("playlists:updated"))}catch{}}function p(){return h().lists}function f(e){g({lists:e})}function y(e){const t=h(),s=String(e||"Playlist").trim()||"Playlist";let r=t.lists.find(e=>e.name.toLowerCase()===s.toLowerCase());return r||(r={id:`pl_${Date.now()}`,name:s,items:[],createdAt:(new Date).toISOString()},t.lists.unshift(r),g(t)),r}function w(e){return y(e)}function v(e,t){const s=h(),r=s.lists.findIndex(t=>t.id===e);r>=0&&(s.lists[r]={...s.lists[r],name:String(t||"").trim()||s.lists[r].name},g(s))}function j(e){const t=h();t.lists=t.lists.filter(t=>t.id!==e),g(t)}function b(e,t){if(!e||!t)return;const s=h(),r=s.lists.find(t=>t.id===e);if(!r)return;const a={id:String(t.id||t.videoId||t.url||t.src||Date.now()),url:t.url||t.src||t.videoUrl||null,title:t.title||"",thumbnail:t.imageUrl||t.thumbnail||"",author:t.author||"",requester:t.requester||"",addedAt:(new Date).toISOString()};r.items.some(e=>String(e.id)===String(a.id))||r.items.unshift(a),g(s)}function N(e,t){const s=h(),r=s.lists.find(t=>t.id===e);r&&(r.items=(r.items||[]).filter(e=>String(e.id)!==String(t)),g(s))}function C(){const x=s();a();const h="undefined"!=typeof window&&window.localStorage.getItem("regaarder_language")||"English",g=e=>t(e,h),[f,y]=r.useState(p()),[b,C]=r.useState(()=>f[0]?.id||null),[S,T]=r.useState("");r.useEffect(()=>{const e=()=>y(p());window.addEventListener("playlists:updated",e);const t=setInterval(e,8e3);return()=>{window.removeEventListener("playlists:updated",e),clearInterval(t)}},[]);const k=r.useMemo(()=>f.find(e=>e.id===b)||f[0]||null,[f,b]),[I,L]=r.useState(!1),[P,E]=r.useState(""),[F,A]=r.useState(""),[U,$]=r.useState(null),[D,M]=r.useState(""),R=r.useRef({}),X=()=>{L(!1)},q=(k?.items||[]).filter(e=>{const t=S.trim().toLowerCase();return!t||((e.title||"").toLowerCase().includes(t)||(e.author||"").toLowerCase().includes(t)||(e.requester||"").toLowerCase().includes(t))});return e.jsxs("div",{className:"flex justify-center min-h-screen w-full bg-white relative",children:[e.jsxs("div",{className:"w-full flex flex-col bg-white overflow-hidden",children:[e.jsx("header",{className:"bg-white border-b border-gray-100 p-4 sticky top-0 z-20",style:{paddingTop:"calc(16px + env(safe-area-inset-top, 0px))"},children:e.jsxs("div",{className:"flex items-center space-x-4 justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(n,{className:"w-6 h-6 text-gray-700 cursor-pointer transition hover:text-gray-900",onClick:()=>{try{"undefined"!=typeof window&&"function"==typeof window.setFooterTab&&window.setFooterTab("home")}catch(e){}try{x("/home",{replace:!0})}catch(e){}}}),e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:g("Playlist")})]}),e.jsx("button",{onClick:()=>{E(""),A(""),L(!0)},className:"text-sm font-medium hover:opacity-80 transition",style:{color:"#FFFFFF",backgroundColor:"var(--color-gold)",padding:"6px 12px",borderRadius:"6px"},children:g("New")})]})}),e.jsx("div",{className:"p-4 space-y-3 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-md px-2 py-2 w-full max-w-md",children:[e.jsxs("svg",{className:"w-4 h-4 text-gray-500",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]}),e.jsx("input",{value:S,onChange:e=>T(e.target.value),placeholder:g("Search"),className:"bg-transparent outline-none text-sm ml-2 w-full"})]}),e.jsx("select",{value:k?.id||"",onChange:e=>C(e.target.value),className:"ml-4 px-2 py-2 border border-gray-200 rounded-md text-sm",children:f.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})}),e.jsxs("main",{className:"flex-grow flex flex-col items-center justify-start p-6 space-y-6",children:[f.length>0&&e.jsx("div",{className:"w-full grid grid-cols-2 gap-4",children:f.map(t=>{const s=t.items&&t.items[0]&&(t.items[0].thumbnail||t.items[0].imageUrl)||"https://placehold.co/320x180/efefef/777?text="+encodeURIComponent(g("Playlist")),r=t.id===k?.id;return e.jsxs("button",{onClick:e=>{"1"!==e.currentTarget.dataset.longpressed?C(t.id):e.currentTarget.dataset.longpressed="0"},className:`w-full text-left bg-white rounded-2xl border ${r?"border-[var(--color-gold)]":"border-gray-200"} overflow-hidden hover:border-gray-300 transition`,onMouseDown:e=>{R.current[t.id]=setTimeout(()=>{try{if(e.currentTarget.dataset.longpressed="1",confirm(g("Delete this playlist?"))){j(t.id);const e=p();y(e),C(e[0]?.id||null)}}catch(s){}},700)},onMouseUp:e=>{clearTimeout(R.current[t.id])},onMouseLeave:e=>{clearTimeout(R.current[t.id])},onTouchStart:e=>{R.current[t.id]=setTimeout(()=>{try{if(e.currentTarget.dataset.longpressed="1",confirm(g("Delete this playlist?"))){j(t.id);const e=p();y(e),C(e[0]?.id||null)}}catch(s){}},700)},onTouchEnd:e=>{clearTimeout(R.current[t.id])},children:[e.jsx("div",{className:"w-full pb-[56%] relative",children:e.jsx("img",{src:s,alt:t.name,className:"absolute inset-0 w-full h-full object-cover",onError:e=>{e.currentTarget.src="https://placehold.co/320x180/efefef/777?text="+encodeURIComponent(g("Playlist"))}})}),e.jsxs("div",{className:"px-3 py-2 relative",children:[U===t.id?e.jsx("input",{autoFocus:!0,value:D,onChange:e=>M(e.target.value),onBlur:()=>{try{v(t.id,(D||"").trim()||t.name),y(p())}catch(e){}$(null)},onKeyDown:e=>{"Enter"===e.key&&e.currentTarget.blur()},className:"w-full text-base font-semibold text-gray-900 truncate outline-none"}):e.jsx("div",{className:"text-base font-semibold text-gray-900 truncate",children:t.name}),e.jsx("button",{onClick:e=>{e.stopPropagation(),$(t.id),M(t.name||"")},className:"absolute top-2 right-2 p-1 text-gray-600 hover:text-gray-900",children:e.jsx(o,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1 mt-0.5",children:[e.jsx("span",{children:g("Private")}),e.jsx("span",{children:"•"}),e.jsx("span",{children:(t.items||[]).length}),e.jsx(d,{className:"w-3.5 h-3.5 ml-auto text-gray-400"})]})]})]},t.id)})}),k?q.length>0?e.jsx("div",{className:"w-full space-y-4",children:q.map(t=>e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:()=>(e=>{const t=e.url||e.id;if(!t)return;const s=new URLSearchParams({src:t,title:e.title||""});window.location.href=`/videoplayer?${s.toString()}`})(t),onTouchStart:e=>{e.currentTarget.dataset.startX=e.touches[0].clientX},onTouchMove:e=>{const t=parseFloat(e.currentTarget.dataset.startX||"0"),s=e.touches[0].clientX-t;e.currentTarget.style.transform=`translateX(${s}px)`},onTouchEnd:e=>{const s=parseFloat(e.currentTarget.dataset.startX||"0"),r=e.changedTouches[0].clientX-s;e.currentTarget.style.transform="",r<-80&&(N(k.id,t.id),y(p())),e.currentTarget.dataset.startX="0"},children:[e.jsx("img",{src:t.thumbnail||"https://placehold.co/160x90/efefef/777?text=Video",alt:t.title,className:"w-40 h-24 object-cover rounded-md",onError:e=>{e.currentTarget.src="https://placehold.co/160x90/efefef/777?text=Video"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:t.title||t.url||t.id}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[t.author,t.author&&t.requester?" • ":"",t.requester]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Added • ",new Date(t.addedAt).toLocaleString()]})]}),e.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900","aria-label":"Share",onClick:e=>{e.stopPropagation();const s=t.id||t.videoId,r=s?`${l}/share/video/${encodeURIComponent(s)}`:t.url?`${l}/videoplayer?src=${encodeURIComponent(t.url)}&title=${encodeURIComponent(t.title||"")}`:window.location.href,a={title:t.title||"Watch this",text:t.title||"Watch this",url:r};if(navigator.share)navigator.share(a).catch(()=>{});else try{navigator.clipboard&&navigator.clipboard.writeText(r),alert(g("Share link copied"))}catch{}},children:e.jsx(c,{className:"w-5 h-5"})})]},`${k.id}:${t.id}`))}):e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[g("Playlist")," “",k.name,"” ",g("has no videos yet")]}),e.jsxs("div",{className:"w-full px-4 py-3 bg-[#F5F5DC] text-gray-700 rounded-xl flex items-start space-x-2",style:{borderColor:"var(--color-gold-light)",borderStyle:"solid",boxShadow:"0 6px 16px rgba(203,138,0,0.06)"},children:[e.jsx(m,{className:"w-4 h-4 mt-0.5 text-[var(--color-gold)] flex-shrink-0"}),e.jsx("p",{className:"text-xs leading-relaxed font-medium",children:g("Use “Add to playlist” from a video’s options to start filling this list. Swipe left on items to remove.")})]})]}):e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center text-center space-y-4 pt-8",children:[e.jsx(u,{className:"w-16 h-16 text-gray-400",strokeWidth:1}),e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:g("No playlists yet")}),e.jsx("p",{className:"text-sm text-gray-500 max-w-xs",children:g("Create your first playlist to organize favorite videos")})]})]}),e.jsx(i,{selectedLanguage:h})]}),I&&e.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center px-4",style:{backgroundColor:"rgba(0,0,0,0.6)"},onClick:X,children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md p-6",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g("Create Playlist")}),e.jsx("button",{className:"p-1 text-gray-500 hover:text-gray-700",onClick:X,children:"✕"})]}),e.jsx("label",{className:"text-sm text-gray-700",children:g("Name")}),e.jsx("input",{value:P,onChange:e=>{E(e.target.value),A("")},placeholder:g("My Playlist"),className:"mt-1 w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-md outline-none"}),F&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:F}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{className:"px-3 py-2 text-sm text-gray-700",onClick:X,children:g("Cancel")}),e.jsx("button",{className:"px-3 py-2 text-sm text-white rounded-md",style:{backgroundColor:"var(--color-gold)"},onClick:()=>{const e=(P||"").trim();if(!e)return void A(g("Please enter a name"));if(f.some(t=>t.name.toLowerCase()===e.toLowerCase()))return void A(g("A playlist with this name already exists"));const t=w(e),s=p();y(s),C(t.id),L(!1)},children:g("Create")})]})]})})]})}async function S(e){const s="undefined"!=typeof window&&window.localStorage.getItem("regaarder_language")||"English",r=e=>t(e,s);try{const t=p().map(e=>e.name),s=r("Add to playlist")+":\n"+(t.length?r("Existing: ")+t.join(", "):r("No playlists yet")),a=prompt(s,t[0]||r("My Playlist"));if(!a)return!1;return b(y(a).id,e),!0}catch{return!1}}export{b as addToPlaylist,w as createPlaylist,C as default,j as deletePlaylist,y as ensurePlaylist,p as getPlaylists,S as promptAddToPlaylist,N as removeFromPlaylist,v as renamePlaylist,f as setPlaylists};
