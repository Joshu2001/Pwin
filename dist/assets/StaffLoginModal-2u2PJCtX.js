import{j as e,E as o,h as t}from"./index-BZKzq6T1.js";import{b as s}from"./vendor-Cml8jNaD.js";import{A as r}from"./alert-circle-XIDTAo2-.js";function n({isOpen:n,onClose:i,onLoginSuccess:a}){const[d,l]=s.useState("login"),[p,c]=s.useState(!1),[x,u]=s.useState(""),[g,f]=s.useState(""),[b,h]=s.useState(!1),[y,m]=s.useState(!1),[w,j]=s.useState(!1),[S,v]=s.useState(null),[C,k]=s.useState(""),[z,R]=s.useState(null),[I,_]=s.useState(!1),[E,L]=s.useState(!1),[A,F]=s.useState({employeeId:"",password1:"",password2:"",password3:""}),[N,O]=s.useState({name:"",email:"",password1:"",password2:"",password3:""});s.useEffect(()=>{try{const e=localStorage.getItem("staffSession");if(e){const o=JSON.parse(e);if(o&&o.employeeId)return a&&a(o),void(i&&i())}}catch{}try{const e=localStorage.getItem("staffRememberedCredentials");if(e){const o=JSON.parse(e);o&&o.employeeId&&(F(o),L(!0))}}catch{}},[]),s.useEffect(()=>{"signup"===d&&null===S&&P()},[d]);const P=async()=>{try{const e=window&&window.__BACKEND_URL__||"https://pwin.onrender.com",o=await fetch(`${e}/staff/next-employee-id`),t=await o.json();t.nextEmployeeId&&v(t.nextEmployeeId)}catch(e){console.error("Error fetching next employee ID:",e)}},B=async e=>{if(e&&e.includes("@")){_(!0);try{const o=window&&window.__BACKEND_URL__||"https://pwin.onrender.com",t=await fetch(`${o}/staff/check-account-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})}),s=await t.json();"approved"===s.status?R({status:"approved",message:`✅ ${s.message}`,type:"success",employeeId:s.employeeId}):"pending"===s.status?R({status:"pending",message:`⏳ ${s.message}`,type:"info"}):"denied"===s.status?R({status:"denied",message:`❌ ${s.message}`,type:"error"}):R({status:"not_found",message:`❓ ${s.message}`,type:"info"})}catch(o){u("Failed to check status"),console.error("Error checking account status:",o)}finally{_(!1)}}else u("Please enter a valid email")};s.useEffect(()=>{if("pending"===z?.status&&C){const e=setInterval(()=>{B(C)},3e3);return()=>clearInterval(e)}},[z?.status,C]);return n?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999,cursor:"pointer"},onClick:e=>{e.target===e.currentTarget&&i()},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"32px",width:"90%",maxWidth:"400px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",cursor:"auto"},onClick:e=>e.stopPropagation(),children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:"bold"},children:"login"===d?"Staff Login":"Create Staff Account"})}),x&&e.jsxs("div",{style:{display:"flex",gap:"8px",padding:"12px",backgroundColor:"#fee2e2",border:"1px solid #fca5a5",borderRadius:"8px",marginBottom:"16px",color:"#dc2626",fontSize:"14px",alignItems:"center"},children:[e.jsx(r,{size:18}),x]}),g&&e.jsx("div",{style:{padding:"12px",backgroundColor:"#dcfce7",border:"1px solid #86efac",borderRadius:"8px",marginBottom:"16px",color:"#16a34a",fontSize:"14px"},children:g}),z&&e.jsxs("div",{style:{padding:"12px",backgroundColor:"success"===z.type?"#dcfce7":"error"===z.type?"#fee2e2":"#dbeafe",border:"success"===z.type?"1px solid #86efac":"error"===z.type?"1px solid #fca5a5":"1px solid #7dd3fc",borderRadius:"8px",marginBottom:"16px",color:"success"===z.type?"#16a34a":"error"===z.type?"#dc2626":"#0369a1",fontSize:"14px"},children:[z.message,"pending"===z.status&&e.jsx("div",{style:{fontSize:"12px",marginTop:"8px",opacity:.8},children:"Checking status... (refreshes every 3 seconds)"})]}),"login"===d?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsx("input",{type:"text",placeholder:"Employee ID",value:A.employeeId,onChange:e=>F({...A,employeeId:e.target.value}),style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit"}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:b?"text":"password",placeholder:"Password 1",value:A.password1,onChange:e=>F({...A,password1:e.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>h(!b),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:b?e.jsx(o,{size:18}):e.jsx(t,{size:18})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:y?"text":"password",placeholder:"Password 2",value:A.password2,onChange:e=>F({...A,password2:e.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>m(!y),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:y?e.jsx(o,{size:18}):e.jsx(t,{size:18})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:w?"text":"password",placeholder:"Password 3",value:A.password3,onChange:e=>F({...A,password3:e.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>j(!w),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:w?e.jsx(o,{size:18}):e.jsx(t,{size:18})})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",fontSize:"14px",color:"#374151",cursor:"pointer",userSelect:"none",padding:"2px 0"},children:[e.jsx("div",{onClick:()=>L(!E),style:{width:20,height:20,borderRadius:4,border:E?"2px solid #3b82f6":"2px solid #d1d5db",backgroundColor:E?"#3b82f6":"#fff",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.15s ease",flexShrink:0},children:E&&e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"#fff",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{onClick:()=>L(!E),children:"Remember Me"})]}),e.jsx("button",{onClick:async()=>{if(u(""),f(""),A.employeeId&&A.password1&&A.password2&&A.password3){c(!0);try{const e=window&&window.__BACKEND_URL__||"https://pwin.onrender.com",o=await fetch(`${e}/staff/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)}),t=await o.json();if(!o.ok)return void u(t.error||"Login failed");localStorage.setItem("staffSession",JSON.stringify(t.employee)),E?localStorage.setItem("staffRememberedCredentials",JSON.stringify(A)):localStorage.removeItem("staffRememberedCredentials"),a(t.employee),i()}catch(e){u("Connection error"),console.error(e)}finally{c(!1)}}else u("All fields are required")},disabled:p,style:{padding:"12px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:p?"not-allowed":"pointer",opacity:p?.6:1},children:p?"Logging in...":"Login"}),e.jsxs("div",{style:{textAlign:"center",fontSize:"14px",color:"#666"},children:["Don't have an account?"," ",e.jsx("button",{onClick:()=>l("signup"),style:{background:"none",border:"none",color:"#3b82f6",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Create one"})]})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",backgroundColor:"#f9fafb",color:"#666"},children:["Employee ID: ",e.jsx("strong",{children:S||"Loading..."})]}),e.jsx("input",{type:"text",placeholder:"Full Name",value:N.name,onChange:e=>O({...N,name:e.target.value}),style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit"}}),e.jsx("input",{type:"email",placeholder:"Email",value:N.email,onChange:e=>O({...N,email:e.target.value}),style:{padding:"12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit"}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:b?"text":"password",placeholder:"Password 1",value:N.password1,onChange:e=>O({...N,password1:e.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>h(!b),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:b?e.jsx(o,{size:18}):e.jsx(t,{size:18})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:y?"text":"password",placeholder:"Password 2",value:N.password2,onChange:e=>O({...N,password2:e.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>m(!y),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:y?e.jsx(o,{size:18}):e.jsx(t,{size:18})})]}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:w?"text":"password",placeholder:"Password 3",value:N.password3,onChange:e=>O({...N,password3:e.target.value}),style:{padding:"12px",paddingRight:"40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",width:"100%",boxSizing:"border-box"}}),e.jsx("button",{onClick:()=>j(!w),style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#666",padding:0},children:w?e.jsx(o,{size:18}):e.jsx(t,{size:18})})]}),e.jsx("button",{onClick:async()=>{if(u(""),f(""),N.name&&N.email&&N.password1&&N.password2&&N.password3)if(N.email.includes("@")){c(!0);try{const e=window&&window.__BACKEND_URL__||"https://pwin.onrender.com",o=await fetch(`${e}/staff/create-account`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N)}),t=await o.json();if(!o.ok)return void u(t.error||"Signup failed");k(N.email),f("Account request submitted. Awaiting Executive approval."),B(N.email),O({name:"",email:"",password1:"",password2:"",password3:""})}catch(e){u("Connection error"),console.error(e)}finally{c(!1)}}else u("Invalid email address");else u("All fields are required")},disabled:p,style:{padding:"12px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",cursor:p?"not-allowed":"pointer",opacity:p?.6:1},children:p?"Creating...":"Create Account"}),e.jsx("button",{onClick:()=>l("login"),style:{background:"none",border:"none",color:"#3b82f6",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Back to Login"})]})]})}):null}export{n as S};
