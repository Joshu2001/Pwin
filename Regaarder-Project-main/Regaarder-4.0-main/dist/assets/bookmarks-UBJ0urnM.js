import{j as e,g as t}from"./index-BxcU9v4P.js";import{d as s,e as r}from"./vendor-Cml8jNaD.js";import{C as a}from"./chevron-left-DDm9_YXt.js";import{S as o}from"./search-Bzpeaihg.js";import{H as n}from"./history-C-jDKGAt.js";import{H as i}from"./home-DxGpoi9r.js";import{F as l,P as c,M as d}from"./pencil-lQ8YT_I-.js";const m="undefined"!=typeof window&&window.__BACKEND_URL__||"https://pwin.onrender.com",h=e=>{try{const t=Math.max(0,Math.floor(Number(e)||0)),s=Math.floor(t/60);return`${s}:${String(t%60).padStart(2,"0")}`}catch{return"0:00"}};function x(){const i=s(),[l,c]=r.useState(""),[d,x]=r.useState([]),[g,f]=r.useState([]),[v,p]=r.useState([]),[j,y]=r.useState({}),[w,b]=r.useState({}),[N,S]=r.useState(localStorage.getItem("regaarder_language")||"English"),k=e=>t(e,N);r.useEffect(()=>{const e=()=>{S(localStorage.getItem("regaarder_language")||"English")};window.addEventListener("storage",e);const t=setInterval(()=>{const e=localStorage.getItem("regaarder_language")||"English";e!==N&&S(e)},1e3);return()=>{window.removeEventListener("storage",e),clearInterval(t)}},[N]);const I=r.useCallback(async()=>{try{const e=localStorage.getItem("regaarder_token");console.log("Fetching bookmarks with token:",!!e);const t=await fetch(`${m}/bookmarks`,{headers:e?{Authorization:`Bearer ${e}`}:{}}).then(e=>e.json()).catch(()=>null);console.log("Bookmarks response:",t),t&&t.success&&(console.log("Segments:",t.segments?.length||0,"Videos:",t.videos?.length||0,"Requests:",t.requests?.length||0),t.requests&&t.requests.length>0&&console.log("Request bookmarks:",t.requests.map(e=>({id:e.id,requestId:e.requestId,title:e.title}))),x(Array.isArray(t.segments)?t.segments:[]),f(Array.isArray(t.videos)?t.videos:[]),p(Array.isArray(t.requests)?t.requests:[]));try{const e=await fetch(`${m}/videos`).then(e=>e.json()).catch(()=>null),t=e&&e.success&&Array.isArray(e.videos)?e.videos:[],s={};t.forEach(e=>{const t=e.videoUrl||e.url;t&&(s[String(t)]={thumbnail:e.imageUrl||e.thumbnail||"",title:e.title||""})}),y(s)}catch{}}catch{}},[]);r.useEffect(()=>{I();const e=setInterval(I,5e3);return()=>clearInterval(e)},[I]);const $=(e,t=0,s="")=>{try{window.location.href=`/videoplayer?src=${encodeURIComponent(e)}&title=${encodeURIComponent(s||"")}&t=${Math.max(0,Math.floor(t||0))}`}catch{}},q=e=>{const t=l.trim().toLowerCase();return!t||String(e||"").toLowerCase().includes(t)};return e.jsx("div",{className:"flex justify-center min-h-screen w-full bg-white relative",children:e.jsxs("div",{className:"w-full flex flex-col bg-white overflow-auto",children:[e.jsx("header",{className:"bg-white border-b border-gray-100 p-4 sticky top-0 z-20",style:{paddingTop:"calc(16px + env(safe-area-inset-top, 0px))"},children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(a,{className:"w-6 h-6 text-gray-700 cursor-pointer transition hover:text-gray-900",onClick:()=>i(-1)}),e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:k("Bookmarks")})]})}),e.jsx("div",{className:"p-4 space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center bg-gray-50 border border-gray-200 rounded-md px-2 py-2 w-full max-w-md",children:[e.jsx(o,{className:"w-4 h-4 text-gray-500"}),e.jsx("input",{value:l,onChange:e=>c(e.target.value),placeholder:k("Search"),className:"bg-transparent outline-none text-sm ml-2 w-full"})]}),e.jsxs("p",{className:"text-sm text-gray-500 ml-4 whitespace-nowrap",children:[d.length+g.length+v.length," ",k("items")]})]})}),e.jsxs("main",{className:"flex-grow flex flex-col items-center justify-start p-6 space-y-8",children:[e.jsxs("section",{className:"w-full",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:k("Timestamped Segments")}),0===d.length?e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:k("No timestamped segments yet")})]}):e.jsx("div",{className:"space-y-3",children:d.filter(e=>q(e.label)||q(e.videoUrl)).map(t=>e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:()=>$(t.videoUrl,t.startTime,t.label||j[String(t.videoUrl)]?.title||""),children:[e.jsx("div",{className:"w-40 h-24 rounded-md bg-black/5",style:{background:j[String(t.videoUrl)]?.thumbnail?`url(${j[String(t.videoUrl)].thumbnail}) center/cover no-repeat`:void 0}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:t.label||j[String(t.videoUrl)]?.title||t.videoUrl}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["Start ",h(t.startTime)," â€¢ End ",h(t.endTime)]}),t.createdAt&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(t.createdAt).toLocaleString()})]})]},t.id))})]}),e.jsxs("section",{className:"w-full",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:k("Videos to Watch")}),0===g.length?e.jsx("div",{className:"text-gray-500",children:k("No video bookmarks")}):e.jsx("div",{className:"space-y-3",children:g.filter(e=>q(e.title)||q(e.videoUrl)).map(t=>e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none relative overflow-hidden",style:{transform:`translateX(${w[t.id]||0}px)`,transition:0===(w[t.id]||0)?"transform 0.3s ease":"none"},onTouchStart:e=>{e.stopPropagation(),b(s=>({...s,[`${t.id}_startX`]:e.touches[0].clientX}))},onTouchMove:e=>{e.stopPropagation();const s=w[`${t.id}_startX`]||0,r=e.touches[0].clientX-s;r<0&&b(e=>({...e,[t.id]:r}))},onTouchEnd:e=>{e.stopPropagation();(w[t.id]||0)<-80?(e=>{const t=g.find(t=>t.id===e);if(!t)return;const s=localStorage.getItem("regaarder_token");fetch(`${m}/bookmarks/videos`,{method:"DELETE",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}},body:JSON.stringify({videoUrl:t.videoUrl})}).then(()=>{f(t=>t.filter(t=>t.id!==e))}).catch(()=>{})})(t.id):b(e=>({...e,[t.id]:0}))},onClick:e=>{Math.abs(w[t.id]||0)<5&&$(t.videoUrl,0,t.title||j[String(t.videoUrl)]?.title||"")},children:[e.jsx("div",{className:"w-40 h-24 rounded-md bg-black/5",style:{background:j[String(t.videoUrl)]?.thumbnail?`url(${j[String(t.videoUrl)].thumbnail}) center/cover no-repeat`:void 0}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:t.title||j[String(t.videoUrl)]?.title||t.videoUrl}),t.createdAt&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(t.createdAt).toLocaleString()})]})]},t.id))})]}),e.jsxs("section",{className:"w-full",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:k("Request Bookmarks")}),0===v.length?e.jsx("div",{className:"text-gray-500",children:k("No request bookmarks")}):e.jsx("div",{className:"space-y-3",children:v.filter(e=>q(e.title)||q(e.requestId)).map(t=>e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none relative overflow-hidden",style:{transform:`translateX(${w[t.id]||0}px)`,transition:0===(w[t.id]||0)?"transform 0.3s ease":"none"},onTouchStart:e=>{e.stopPropagation(),b(s=>({...s,[`${t.id}_startX`]:e.touches[0].clientX}))},onTouchMove:e=>{e.stopPropagation();const s=w[`${t.id}_startX`]||0,r=e.touches[0].clientX-s;r<0&&b(e=>({...e,[t.id]:r}))},onTouchEnd:e=>{e.stopPropagation();(w[t.id]||0)<-80?(e=>{const t=v.find(t=>t.id===e);if(!t)return;const s=localStorage.getItem("regaarder_token");fetch(`${m}/bookmarks/requests`,{method:"DELETE",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}},body:JSON.stringify({requestId:t.requestId})}).then(()=>{p(t=>t.filter(t=>t.id!==e))}).catch(()=>{})})(t.id):b(e=>({...e,[t.id]:0}))},onClick:()=>{if(Math.abs(w[t.id]||0)<5){try{localStorage.setItem("focus_request_hint",JSON.stringify({title:t.title||""}))}catch{}const e=encodeURIComponent(t.title||""),s=encodeURIComponent(t.requestId||"");window.location.href=`/requests.jsx${s?`?reqId=${s}`:""}${e?`${s?"&":"?"}q=${e}`:""}`}},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:"R"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:t.title||t.requestId}),t.createdAt&&e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:new Date(t.createdAt).toLocaleString()})]})]},t.id))})]}),e.jsxs("div",{className:"w-full px-4 py-3 bg-[#F5F5DC] text-gray-700 rounded-xl flex items-start space-x-2",style:{borderColor:"var(--color-gold-light)",borderWidth:"1px",borderStyle:"solid",boxShadow:"0 6px 16px rgba(203,139,4,0.06)"},children:[e.jsx("svg",{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--color-gold)"},fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("p",{className:"text-xs leading-relaxed font-medium",children:k("Swipe left to delete bookmark")})]})]}),e.jsx(u,{})]})})}const u=()=>{const[s,a]=r.useState(null),o=r.useRef(!1),n=localStorage.getItem("regaarder_language")||"English",m=[{name:"Home",icon:i},{name:"Requests",icon:l},{name:"Ideas",icon:c},{name:"More",icon:d}];return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg z-50",style:{paddingTop:"10px",paddingBottom:"calc(12px + env(safe-area-inset-bottom, 0px))",minHeight:"70px"},children:e.jsx("div",{className:"w-full flex justify-around items-center px-2",children:m.map(r=>{const i=r.name===s,l=i?{color:"var(--color-gold)"}:{color:"rgb(107 114 128)"},c=i?"font-semibold":"font-normal",d=r.icon,m=e=>{try{if("Home"===e)return void(window.location.href="/home.jsx");if("Requests"===e)return void(window.location.href="/requests.jsx");if("Ideas"===e)return void(window.location.href="/ideas");if("More"===e)return void(window.location.href="/more.jsx")}catch(t){console.warn("Navigation failed",t)}};return e.jsx("div",{className:"relative flex flex-col items-center justify-center flex-1 focus:outline-none",children:e.jsxs("button",{className:"flex flex-col items-center w-full h-full justify-center",onMouseDown:()=>{a(r.name),o.current||(o.current=!0,m(r.name))},onTouchStart:()=>{a(r.name),o.current||(o.current=!0,m(r.name))},onClick:e=>{if(o.current)return o.current=!1,void e.preventDefault();a(r.name),m(r.name)},children:[e.jsx("div",{className:"w-12 h-12 flex items-center justify-center rounded-xl transition-colors",children:e.jsx(d,{size:24,strokeWidth:i?2:1.5,style:l})}),e.jsx("span",{className:`text-xs leading-tight mt-1 ${c}`,style:l,children:(h=r.name,t(h,n))})]})},r.name);var h})})})};export{x as default};
