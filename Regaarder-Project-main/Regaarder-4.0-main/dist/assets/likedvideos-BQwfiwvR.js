import{j as e,g as t}from"./index-BquHsqrT.js";import{d as o,b as r}from"./vendor-Cml8jNaD.js";import{u as a}from"./navigation-CVpX3VBE.js";import{g as i,W as s}from"./config-DzyQUiLS.js";import{S as n}from"./SharedBottomBar-DxwbZ5xd.js";import{C as l}from"./chevron-left-BrX7WC8Y.js";import{L as d}from"./lightbulb-BW-W7RRV.js";import{M as c}from"./pencil-ff90-lub.js";import"./home-Boow_oaN.js";const m="undefined"!=typeof window&&localStorage.getItem("regaarder_language")||"English",u=e=>t(e,m),h="likedVideos",f=()=>i();async function g(e){try{if(!e||!e.videoId)return;const o=localStorage.getItem(h),r=o?JSON.parse(o):[],a=r.findIndex(t=>t.videoId===e.videoId);if(e.liked){const t={videoId:e.videoId,url:e.url||null,title:e.title||null,creatorName:e.creatorName||null,imageUrl:e.imageUrl||null,likedAt:e.timestamp||(new Date).toISOString()};a>=0?r[a]=t:r.unshift(t)}else a>=0&&r.splice(a,1);localStorage.setItem(h,JSON.stringify(r.slice(0,500)));try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:r.length}}))}catch{}try{const t=localStorage.getItem("regaarder_token");t&&await fetch(`${f()}/likes`,{method:e.liked?"POST":"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({videoId:e.videoId})})}catch(t){console.warn("Failed to sync like to backend",t)}}catch{}}function v(){try{localStorage.removeItem(h)}catch{}try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:0}}))}catch{}}function p(){try{const e=localStorage.getItem(h);return(e?JSON.parse(e):[]).sort((e,t)=>String(t.likedAt).localeCompare(String(e.likedAt)))}catch{return[]}}function y(){const t=o();a();const[i,y]=r.useState(()=>p()),[x,w]=r.useState({}),[b,I]=r.useState(""),[k,j]=r.useState(()=>{try{return"true"===localStorage.getItem("darkMode")}catch{return!1}});r.useRef(null);const N=r.useRef({}),[S,C]=r.useState({}),E=(e,t)=>C(o=>({...o,[e]:t}));r.useEffect(()=>{const e=()=>y(p());window.addEventListener("likes:updated",e);const t=setInterval(e,5e3);return()=>{window.removeEventListener("likes:updated",e),clearInterval(t)}},[]),r.useEffect(()=>{(async()=>{try{const e=localStorage.getItem("regaarder_token");if(!e)return;const t=await fetch(`${f()}/likes`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return;const o=await t.json(),r=Array.isArray(o.likes)?o.likes:Array.isArray(o)?o:[];if(0===r.length)return;const a=p(),i=new Set(a.map(e=>e.videoId));let s=!1;for(const n of r){const e=n.videoId||n.video_id;e&&!i.has(e)&&(a.push({videoId:e,url:n.url||n.videoUrl||null,title:n.title||null,creatorName:n.creatorName||n.author||null,imageUrl:n.imageUrl||n.thumbnail||null,likedAt:n.likedAt||n.created_at||(new Date).toISOString()}),s=!0)}s&&(a.sort((e,t)=>String(t.likedAt).localeCompare(String(e.likedAt))),localStorage.setItem(h,JSON.stringify(a.slice(0,500))),y(p()),console.log("[LikedVideos] Hydrated from backend:",r.length,"server likes"))}catch(e){console.warn("[LikedVideos] Backend hydration failed:",e)}})()},[]),r.useEffect(()=>{let e=!0;const t=async()=>{try{const t=await fetch(`${f()}/videos`).catch(()=>null),o=t&&t.ok?await t.json():null,r=o&&o.videos||[],a={},i={};r.forEach(e=>{if(!e)return;e.id&&(a[e.id]=e),e.videoUrl&&(a[e.videoUrl]=e),e.url&&(a[e.url]=e);const t=(e.title||"").toLowerCase().trim();t&&(i[t]=e)}),e&&w({byKey:a,byTitle:i})}catch(t){}};t();const o=setInterval(t,1e4);return()=>{e=!1,clearInterval(o)}},[]);const A=r.useMemo(()=>{const e=(b||"").trim().toLowerCase();return e?i.filter(t=>(t.title||"").toLowerCase().includes(e)||(t.creatorName||"").toLowerCase().includes(e)||(t.url||"").toLowerCase().includes(e)):i},[i,b]);return e.jsxs("div",{style:{minHeight:"100vh",background:k?"#0e0e0e":"#f9fafb"},children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-white border-b",style:{borderColor:k?"#1a1a1a":"#e5e7eb"},children:e.jsxs("div",{className:"px-4 py-4 sticky top-0 z-20 flex items-center space-x-4",style:{paddingTop:"calc(16px + env(safe-area-inset-top, 0px))"},children:[e.jsx(l,{className:"w-6 h-6 cursor-pointer transition hover:opacity-75",style:{color:k?"#fff":"#374151"},onClick:()=>{try{"undefined"!=typeof window&&"function"==typeof window.setFooterTab&&window.setFooterTab("home")}catch(e){}try{t("/home",{replace:!0})}catch(e){}}}),e.jsx("h1",{className:"text-xl font-semibold",style:{color:k?"#fff":"#111"},children:u("Liked Videos")})]})}),e.jsxs("div",{className:"px-4 py-4",style:{borderBottom:"1px solid "+(k?"#1a1a1a":"#e5e7eb")},children:[i.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>{v(),y([])},className:"text-sm font-medium hover:opacity-80 transition duration-150",style:{color:"#FFFFFF",backgroundColor:"var(--color-gold)",padding:"6px 12px",borderRadius:"6px"},children:u("Clear All")})}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("input",{value:b,onChange:e=>I(e.target.value),placeholder:u("Search liked videos"),className:"flex-1 px-3 py-2 rounded-md",style:{background:k?"#0b0b0b":"#fff",color:k?"#fff":"#111",border:"1px solid "+(k?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.08)")}}),e.jsxs("span",{className:"text-sm",style:{color:k?"#9ca3af":"#6b7280"},children:[A.length," ",1===A.length?u("video"):u("videos")]})]})]}),i.length>0&&e.jsxs("div",{className:"mt-3 rounded-lg p-3 flex items-center gap-2 mx-4",style:{background:k?"rgba(250,204,21,0.08)":"#FEF9C3",border:"1px solid "+(k?"rgba(250,204,21,0.25)":"#FDE68A")},children:[e.jsx(d,{className:"w-4 h-4",style:{color:"#ca8a04"}}),e.jsx("div",{className:"text-xs",style:{color:k?"#fcd34d":"#92400E"},children:u("Swipe left to remove from Liked Videos")})]}),e.jsx("div",{className:"px-4 py-6",children:e.jsxs("div",{className:"mt-5 w-full space-y-4",children:[0===A.length&&e.jsx("div",{className:"text-sm",style:{color:k?"#9ca3af":"#6b7280"},children:u("No likes yet. Tap the heart in the player to add videos here.")}),A.map(o=>{const r=o.title||o.url||o.videoId,a=o.creatorName||"",i=x&&x.byKey?x.byKey:x,n=x&&x.byTitle?x.byTitle:{},l=o.videoId&&i[o.videoId]||o.url&&i[o.url]||r&&n[r.toLowerCase()],d=o.imageUrl||l&&(l.imageUrl||l.thumbnail||l.image)||"https://placehold.co/160x90/efefef/777?text=Video";return e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:e=>{const r=N.current[o.videoId];r&&r.moved||(e=>{const o=e.url||e.videoId,r=e.title||"";try{const t={url:o,title:r,creatorName:e.creatorName};localStorage.setItem("miniPlayerData",JSON.stringify(t))}catch{}try{const e=`/videoplayer?src=${encodeURIComponent(o||"")}&title=${encodeURIComponent(r||"")}`;window.location.href=e}catch{t("/videoplayer")}})(o)},onPointerDown:e=>{const t=e.clientX??(e.touches&&e.touches[0]?.clientX);N.current[o.videoId]={dragging:!0,startX:t,moved:!1}},onPointerMove:e=>{const t=N.current[o.videoId];if(!t||!t.dragging)return;const r=e.clientX??(e.touches&&e.touches[0]?.clientX);if("number"!=typeof r)return;const a=r-t.startX;Math.abs(a)>3&&(t.moved=!0);const i=Math.min(0,a);E(o.videoId,Math.max(-240,i))},onPointerUp:e=>{if(!N.current[o.videoId])return;const t=S[o.videoId]||0;N.current[o.videoId]={dragging:!1,startX:0,moved:!1},t<=-80?(E(o.videoId,-320),setTimeout(()=>(e=>{try{g({videoId:e,liked:!1})}catch{}y(p()),C(t=>{const o={...t};return delete o[e],o});try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:p().length}}))}catch{}})(o.videoId),120)):E(o.videoId,0)},style:{transform:`translateX(${S[o.videoId]||0}px)`,transition:N.current[o.videoId]?.dragging?"none":"transform 220ms ease",opacity:(S[o.videoId]||0)<0?.98:1,touchAction:"pan-y"},children:[e.jsx("img",{src:d,alt:r,className:"w-40 h-24 object-cover rounded-md",onError:e=>{e.currentTarget.src="https://placehold.co/160x90/efefef/777?text=Video"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:r}),a&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["@",a]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[u("Liked")," â€¢ ",(m=o.likedAt,new Date(m).toLocaleString())]})]}),e.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900","aria-label":"Share",onClick:e=>{e.stopPropagation();const t=o.id||o.videoId,a=o.url||o.videoId,i=t?`${s}/share/video/${encodeURIComponent(t)}`:a?`${s}/videoplayer?src=${encodeURIComponent(a)}&title=${encodeURIComponent(r||"")}`:window.location.href,n={title:r,text:r,url:i};if(navigator.share)navigator.share(n).catch(()=>{});else try{navigator.clipboard&&navigator.clipboard.writeText(i),alert(u("Share link copied"))}catch{}},children:e.jsx(c,{className:"w-5 h-5"})})]},o.videoId);var m})]})})]}),e.jsx(n,{selectedLanguage:m}),e.jsx("style",{children:"\n        @keyframes toastSlideDown {\n          from { opacity: 0; transform: translateY(-20px) scale(0.95); }\n          to { opacity: 1; transform: translateY(0) scale(1); }\n        }\n      "})]})}export{v as clearLikedVideos,y as default,g as recordLike};
