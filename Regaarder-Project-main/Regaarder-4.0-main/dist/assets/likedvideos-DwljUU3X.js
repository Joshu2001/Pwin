import{j as e,g as t}from"./index-BzuB3mX8.js";import{d as o,b as r}from"./vendor-Cml8jNaD.js";import{u as a}from"./navigation-CVpX3VBE.js";import{W as s}from"./config-DzyQUiLS.js";import{S as i}from"./SharedBottomBar-CVOcO0up.js";import{C as n}from"./chevron-left-CWMQUHBI.js";import{L as l}from"./lightbulb-DXcEiGPl.js";import{M as d}from"./pencil-Dci8HX-Q.js";import"./home-Dt30oW78.js";const c="undefined"!=typeof window&&localStorage.getItem("regaarder_language")||"English",m=e=>t(e,c),u="likedVideos",h="undefined"!=typeof window&&window.__BACKEND_URL__||"https://pwin.onrender.com";async function p(e){try{if(!e||!e.videoId)return;const o=localStorage.getItem(u),r=o?JSON.parse(o):[],a=r.findIndex(t=>t.videoId===e.videoId);if(e.liked){const t={videoId:e.videoId,url:e.url||null,title:e.title||null,creatorName:e.creatorName||null,imageUrl:e.imageUrl||null,likedAt:e.timestamp||(new Date).toISOString()};a>=0?r[a]=t:r.unshift(t)}else a>=0&&r.splice(a,1);localStorage.setItem(u,JSON.stringify(r.slice(0,500)));try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:r.length}}))}catch{}try{const t=localStorage.getItem("regaarder_token");t&&await fetch(`${h}/likes`,{method:e.liked?"POST":"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({videoId:e.videoId})})}catch(t){console.warn("Failed to sync like to backend",t)}}catch{}}function v(){try{localStorage.removeItem(u)}catch{}try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:0}}))}catch{}}function f(){try{const e=localStorage.getItem(u);return(e?JSON.parse(e):[]).sort((e,t)=>String(t.likedAt).localeCompare(String(e.likedAt)))}catch{return[]}}function g(){const t=o();a();const[u,g]=r.useState(()=>f()),[x,y]=r.useState({}),[w,b]=r.useState(""),[I,j]=r.useState(()=>{try{return"true"===localStorage.getItem("darkMode")}catch{return!1}});r.useRef(null);const N=r.useRef({}),[k,S]=r.useState({}),C=(e,t)=>S(o=>({...o,[e]:t}));r.useEffect(()=>{const e=()=>g(f());window.addEventListener("likes:updated",e);const t=setInterval(e,5e3);return()=>{window.removeEventListener("likes:updated",e),clearInterval(t)}},[]),r.useEffect(()=>{let e=!0;const t=async()=>{try{const t=await fetch(`${h}/videos`).catch(()=>null),o=t&&t.ok?await t.json():null,r=o&&o.videos||[],a={},s={};r.forEach(e=>{if(!e)return;e.id&&(a[e.id]=e),e.videoUrl&&(a[e.videoUrl]=e),e.url&&(a[e.url]=e);const t=(e.title||"").toLowerCase().trim();t&&(s[t]=e)}),e&&y({byKey:a,byTitle:s})}catch(t){}};t();const o=setInterval(t,1e4);return()=>{e=!1,clearInterval(o)}},[]);const E=r.useMemo(()=>{const e=(w||"").trim().toLowerCase();return e?u.filter(t=>(t.title||"").toLowerCase().includes(e)||(t.creatorName||"").toLowerCase().includes(e)||(t.url||"").toLowerCase().includes(e)):u},[u,w]);return e.jsxs("div",{style:{minHeight:"100vh",background:I?"#0e0e0e":"#f9fafb"},children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"bg-white border-b",style:{borderColor:I?"#1a1a1a":"#e5e7eb"},children:e.jsxs("div",{className:"px-4 py-4 sticky top-0 z-20 flex items-center space-x-4",style:{paddingTop:"calc(16px + env(safe-area-inset-top, 0px))"},children:[e.jsx(n,{className:"w-6 h-6 cursor-pointer transition hover:opacity-75",style:{color:I?"#fff":"#374151"},onClick:()=>{try{"undefined"!=typeof window&&"function"==typeof window.setFooterTab&&window.setFooterTab("home")}catch(e){}try{t("/home",{replace:!0})}catch(e){}}}),e.jsx("h1",{className:"text-xl font-semibold",style:{color:I?"#fff":"#111"},children:m("Liked Videos")})]})}),e.jsxs("div",{className:"px-4 py-4",style:{borderBottom:"1px solid "+(I?"#1a1a1a":"#e5e7eb")},children:[u.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:()=>{v(),g([])},className:"text-sm font-medium hover:opacity-80 transition duration-150",style:{color:"#FFFFFF",backgroundColor:"var(--color-gold)",padding:"6px 12px",borderRadius:"6px"},children:m("Clear All")})}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("input",{value:w,onChange:e=>b(e.target.value),placeholder:m("Search liked videos"),className:"flex-1 px-3 py-2 rounded-md",style:{background:I?"#0b0b0b":"#fff",color:I?"#fff":"#111",border:"1px solid "+(I?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.08)")}}),e.jsxs("span",{className:"text-sm",style:{color:I?"#9ca3af":"#6b7280"},children:[E.length," ",1===E.length?m("video"):m("videos")]})]})]}),u.length>0&&e.jsxs("div",{className:"mt-3 rounded-lg p-3 flex items-center gap-2 mx-4",style:{background:I?"rgba(250,204,21,0.08)":"#FEF9C3",border:"1px solid "+(I?"rgba(250,204,21,0.25)":"#FDE68A")},children:[e.jsx(l,{className:"w-4 h-4",style:{color:"#ca8a04"}}),e.jsx("div",{className:"text-xs",style:{color:I?"#fcd34d":"#92400E"},children:m("Swipe left to remove from Liked Videos")})]}),e.jsx("div",{className:"px-4 py-6",children:e.jsxs("div",{className:"mt-5 w-full space-y-4",children:[0===E.length&&e.jsx("div",{className:"text-sm",style:{color:I?"#9ca3af":"#6b7280"},children:m("No likes yet. Tap the heart in the player to add videos here.")}),E.map(o=>{const r=o.title||o.url||o.videoId,a=o.creatorName||"",i=x&&x.byKey?x.byKey:x,n=x&&x.byTitle?x.byTitle:{},l=o.videoId&&i[o.videoId]||o.url&&i[o.url]||r&&n[r.toLowerCase()],c=o.imageUrl||l&&(l.imageUrl||l.thumbnail||l.image)||"https://placehold.co/160x90/efefef/777?text=Video";return e.jsxs("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-100 p-2 flex items-center space-x-3 select-none",onClick:e=>{const r=N.current[o.videoId];r&&r.moved||(e=>{const o=e.url||e.videoId,r=e.title||"";try{const t={url:o,title:r,creatorName:e.creatorName};localStorage.setItem("miniPlayerData",JSON.stringify(t))}catch{}try{const e=`/videoplayer?src=${encodeURIComponent(o||"")}&title=${encodeURIComponent(r||"")}`;window.location.href=e}catch{t("/videoplayer")}})(o)},onPointerDown:e=>{const t=e.clientX??(e.touches&&e.touches[0]?.clientX);N.current[o.videoId]={dragging:!0,startX:t,moved:!1}},onPointerMove:e=>{const t=N.current[o.videoId];if(!t||!t.dragging)return;const r=e.clientX??(e.touches&&e.touches[0]?.clientX);if("number"!=typeof r)return;const a=r-t.startX;Math.abs(a)>3&&(t.moved=!0);const s=Math.min(0,a);C(o.videoId,Math.max(-240,s))},onPointerUp:e=>{if(!N.current[o.videoId])return;const t=k[o.videoId]||0;N.current[o.videoId]={dragging:!1,startX:0,moved:!1},t<=-80?(C(o.videoId,-320),setTimeout(()=>(e=>{try{p({videoId:e,liked:!1})}catch{}g(f()),S(t=>{const o={...t};return delete o[e],o});try{window.dispatchEvent(new CustomEvent("likes:updated",{detail:{count:f().length}}))}catch{}})(o.videoId),120)):C(o.videoId,0)},style:{transform:`translateX(${k[o.videoId]||0}px)`,transition:N.current[o.videoId]?.dragging?"none":"transform 220ms ease",opacity:(k[o.videoId]||0)<0?.98:1,touchAction:"pan-y"},children:[e.jsx("img",{src:c,alt:r,className:"w-40 h-24 object-cover rounded-md",onError:e=>{e.currentTarget.src="https://placehold.co/160x90/efefef/777?text=Video"}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:r}),a&&e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:["@",a]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[m("Liked")," â€¢ ",(u=o.likedAt,new Date(u).toLocaleString())]})]}),e.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900","aria-label":"Share",onClick:e=>{e.stopPropagation();const t=o.id||o.videoId,a=o.url||o.videoId,i=t?`${s}/share/video/${encodeURIComponent(t)}`:a?`${s}/videoplayer?src=${encodeURIComponent(a)}&title=${encodeURIComponent(r||"")}`:window.location.href,n={title:r,text:r,url:i};if(navigator.share)navigator.share(n).catch(()=>{});else try{navigator.clipboard&&navigator.clipboard.writeText(i),alert(m("Share link copied"))}catch{}},children:e.jsx(d,{className:"w-5 h-5"})})]},o.videoId);var u})]})})]}),e.jsx(i,{selectedLanguage:c}),e.jsx("style",{children:"\n        @keyframes toastSlideDown {\n          from { opacity: 0; transform: translateY(-20px) scale(0.95); }\n          to { opacity: 1; transform: translateY(0) scale(1); }\n        }\n      "})]})}export{v as clearLikedVideos,g as default,p as recordLike};
